%prelude {
#include "yystype.h"
#include "outputHandler.h"
}
	 
%token bool,‬‬ ‫‪break,‬‬ ‫‪case,‬‬ ‫‪char,‬‬ ‫‪const,‬‬ ‫‪continue,‬‬ ‫‪default,‬‬ ‫‪double,‬‬ ‫‪else,‬‬ ‫‪extern,‬‬ ‫‪false,‬‬ ‫function,‬‬ ‫‪float,‬‬ ‫‪for,‬‬ ‫‪goto,‬‬ ‫‪if,‬‬ ‫‪input,‬‬ ‫‪int,‬‬ ‫‪long,‬‬ ‫‪output,‬‬ ‫‪return,‬‬ ‫‪record,‬‬ ‫‪sizeof,‬‬ ‫‪static,‬‬ ‫‪string,‬‬ ‫‪switch,‬‬ ‫‪true‬‬, procedure;

program :
	((var_dcl)* | ‫(func_proc)* | (struct_dec)*)+
;

func_proc :
	func_dcl
| proc_dcl
| extern_dcl
;

func_dcl :
	type id '(' (arguments)? ')' SEMICOLON
| type id '(' (arguments)? ')' block
;

extern_dcl :
	extern type idSEMICOLON
;

arguments :
	type id (('['']')*)? (',' arguments)?
;

proc_dcl :
	procedure id '(' (arguments)? ')'SEMICOLON
| procedure id '(' (arguments)? ')' block
;

type :
	int
| bool
| float
| long
| char
| double
| id
| string
| void
| auto
;

struct_dec :
	record id  OPENCURLYBRACE (var_dcl)+ CLOSECURLYBRACE SEMICOLON
;

var_dcl :
	(const)? type var_dcl_cnt ((',' var_dcl_cnt)?)* SEMICOLON
;

var_dcl_cnt :
	variable ('=' expr)?
;

block :
	 OPENCURLYBRACE ((var_dcl | statement))* CLOSECURLYBRACE 
;

statemetn :
	assignmentSEMICOLON
| method_call SEMICOLON
| cond_stmt
| loop_stmt
| return (expr)? SEMICOLON
| goto;
| label
| break;
| continue;
| sizeof'(' type ')'SEMICOLON
;

assignment :
	variable '=' expr
;

method_call :
	id '(' (parameters)? ')'
;

parameters :
	expr
| expr',' parameters
;

cond_stmt :
	if '(' expr ')' block (else block)?
| switch '(' id ')' of':'  OPENCURLYBRACE  (case int_const':' (block)*)* default':' block  CLOSECURLYBRACE 
;

loop_stmt :
	for '(' (var_dcl)? SEMICOLON expr SEMICOLON (assignment | expr)? ')' block
| repeat block until '(' expr ')'SEMICOLON
| foreach '(' id in id ')' block
;

goto :
	goto id
;

label :
	id':'
;

expr :
	expr binary_op expr
| '(' expr ')'
| method_call
| variable
| const_vall
| '-' expr
| '!' expr
;

variable :
	id (( '[' expr ']' )+)? ('.' variable)?
| '~'variable
| '--' variable
| '++' variable
| variable'--'
| variable'++'
;

binary_op :
	arithmatic
| conditional
;

arithmatic :
	'+'
| '-'
| '*'
| '/'
| '%'
| '&'
| '|'
| '^'
| '||'
| '&&'
;

conditionl :
	'=='
| '!='
| '>='
| '<='
| '<'
| '>'
;

const_val :
	int_const
| real_const
| char_const
| bool_const
| string_const
| long_const
;